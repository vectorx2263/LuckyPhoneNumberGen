<html>

<head>
    <title>Lucky Phone Number Generator | Patiphol Pussawong 6088136 Sec-1</title>
    <style>
        .error-txt {
            color: red;
        }
    </style>
</head>

<body>
    <h1>Lucky Phone Number Generator</h1>
    <h3>Generated Number : <span id="output"></span></h3>
    <h3>Sum of this Number : <span id="sum"></span></h3>
    <p id="description"></p>
    <form id="options-form">
        <p>Select starting number :
            <select name="starting" id="starting">
            <option value="08">08</option>
            <option value="09">09</option>
        </select>
        </p>
        <p>
            Not include these numbers : <br>
            <input type="checkbox" name="badnum" value="1" id="1"> 1
            <input type="checkbox" name="badnum" value="2" id="2"> 2
            <input type="checkbox" name="badnum" value="3" id="3"> 3
            <input type="checkbox" name="badnum" value="4" id="4"> 4
            <input type="checkbox" name="badnum" value="5" id="5"> 5
            <input type="checkbox" name="badnum" value="6" id="6"> 6
            <input type="checkbox" name="badnum" value="7" id="7"> 7
            <input type="checkbox" name="badnum" value="8" id="8"> 8
            <input type="checkbox" name="badnum" value="9" id="9"> 9
        </p>
        <p>Select your category :
            <select name="category" id="category">
            <option value="Work">Work</option>
            <option value="Love">Love</option>
            <option value="Wealth">Wealth</option>
            <option value="Merchandising">Merchandising</option>
            <option value="Technology">Technology</option>
            <option value="Education/Wiseness">Education/Wiseness</option>
        </select>
        </p>
    </form>
    <button onclick="calculate()">Re-Generate</button>

    <script type="application/javascript">
        //decalre element pointer
        var form = document.getElementById("options-form");

        //onformchange > run function calculate
        form.addEventListener('change', calculate);

        var output = document.getElementById("output");
        var startingnum = document.getElementById("starting");
        var category = document.getElementById("category");
        var sumoutput = document.getElementById("sum");
        //declare generate phone number and set to empty
        var generatedNum = new Array();

        //declare all lucky number in array type
        var WorkNum = [
            [4, 5],
            [4, 6],
            [7, 8],
            [8, 7],
            [3, 9],
            [9, 3],
            [5, 6]
        ];
        var LoveNum = [
            [3, 2],
            [2, 4],
            [6, 2],
            [3, 6],
            [6, 3],
            [6, 9],
            [9, 6]
        ];
        var WealthNum = [
            [2, 8],
            [8, 2],
            [4, 5],
            [5, 4],
            [6, 5],
            [5, 6],
            [7, 8]
        ];
        var MerchandisingNum = [
            [4, 4],
            [2, 2],
            [4, 1],
            [1, 6],
            [6, 1],
            [2, 6],
            [4, 2]
        ];
        var TechnologyNum = [
            [9, 8],
            [8, 9],
            [9, 9],
            [5, 9],
            [9, 5],
            [9, 1],
            [1, 9]
        ];
        var EducationNum = [
            [1, 5],
            [5, 1],
            [1, 4],
            [4, 1],
            [5, 5],
            [3, 9],
            [2, 3]
        ];

        //function calculate for control overall function
        function calculate() {
            //reset generated phone number to be empty if there are some generated
            generatedNum = new Array();
            //reset classname if previous generate occur error
            output.className = "";
            description.className = "";
            //console.log("form changed");
            //check if starting num is equal to what ?
            if (startingnum.value == "08") {
                //push that number into generatedNum array
                generatedNum.push(0);
                generatedNum.push(8);
            } else {
                //push that number into generatedNum array
                generatedNum.push(0);
                generatedNum.push(8);
            }
            //console.log(generatedNum);

            //declare checkbox pointer
            var one = document.getElementById("1").checked;
            var two = document.getElementById("2").checked;
            var three = document.getElementById("3").checked;
            var four = document.getElementById("4").checked;
            var five = document.getElementById("5").checked;
            var six = document.getElementById("6").checked;
            var seven = document.getElementById("7").checked;
            var eight = document.getElementById("8").checked;
            var nine = document.getElementById("9").checked;

            //declare dontwantNum array that will contains exclude number
            var dontwantNum = new Array();

            //check each checkbox individually if checked so push that number into dontwantNum array
            if (one) {
                //console.log("don't want 1 with " + output.innerHTML);
                dontwantNum.push(1);
                //console.log("changed to " + output.innerHTML);
            }
            if (two) {
                //console.log("don't want 1 with " + output.innerHTML);
                dontwantNum.push(2);
                //console.log("changed to " + output.innerHTML);
            }
            if (three) {
                //console.log("don't want 1 with " + output.innerHTML);
                dontwantNum.push(3);
                //console.log("changed to " + output.innerHTML);
            }
            if (four) {
                //console.log("don't want 1 with " + output.innerHTML);
                dontwantNum.push(4);
                //console.log("changed to " + output.innerHTML);
            }
            if (five) {
                //console.log("don't want 1 with " + output.innerHTML);
                dontwantNum.push(5);
                //console.log("changed to " + output.innerHTML);
            }
            if (six) {
                //console.log("don't want 1 with " + output.innerHTML);
                dontwantNum.push(6);
                //console.log("changed to " + output.innerHTML);
            }
            if (seven) {
                //console.log("don't want 1 with " + output.innerHTML);
                dontwantNum.push(7);
                //console.log("changed to " + output.innerHTML);
            }
            if (eight) {
                //console.log("don't want 1 with " + output.innerHTML);
                dontwantNum.push(8);
                //console.log("changed to " + output.innerHTML);
            }
            if (nine) {
                //console.log("don't want 1 with " + output.innerHTML);
                dontwantNum.push(9);
                //console.log("changed to " + output.innerHTML);
            }
            //console.log(replaceNum(output.innerHTML, dontwantNum));

            //finally we'll get dontwantNum array like [1,3,5] for exclude 1 3 5 number

            //call function generatePhoneNum to generate 8 digits left
            //pass exclude number, category into this function.
            generatePhoneNum(dontwantNum, category.value);
        }

        //generate phone number takes dontWantNum to be the number that will exclude and category.
        function generatePhoneNum(dontWantNum, category) {
            //declare variable for keep LuckyNum that available after deleted by exclude numbers.
            var availableLuckyNum;
            //declare variable for keeping random index of availableLuckyNum;
            var ranLuc;
            //console.log(category);
            //check category
            switch (category) {
                case "Work":
                    //console.log(dontWantNum);
                    //call function remNumfromArray to remove Lucky Number that contain some of exclude numbers and keep in availableLuckyNum.
                    availableLuckyNum = remNumfromArray(WorkNum, dontWantNum);
                    //console.log(availableLuckyNum);
                    //check if there are some LuckyNum left?
                    if (availableLuckyNum.length > 0) {
                        //if yes so random number of those available LuckyNum.
                        ranLuc = Math.floor(Math.random() * availableLuckyNum.length);
                        //console.log("Lucky number is " + availableLuckyNum[ranLuc]);
                        //call function generateNewWLuckyNum to generate 8 digits with Lucky Number in it and exclude numbers that doesn't want.
                        output.innerHTML = generateNumWLuckyNum(generatedNum, availableLuckyNum[ranLuc], dontWantNum);
                    } else {
                        //if there are no available Lucky Number left so tell the user that we can't generate phone number according to your settings.
                        output.innerHTML = "Cannot generate phone number";
                    }
                    break;
                case "Love":
                    availableLuckyNum = remNumfromArray(LoveNum, dontWantNum);
                    if (availableLuckyNum.length > 0) {
                        ranLuc = Math.floor(Math.random() * availableLuckyNum.length);
                        output.innerHTML = generateNumWLuckyNum(generatedNum, availableLuckyNum[ranLuc], dontWantNum);
                    } else {
                        output.innerHTML = "Cannot generate phone number";
                    }
                    break;
                case "Wealth":
                    availableLuckyNum = remNumfromArray(WealthNum, dontWantNum);
                    if (availableLuckyNum.length > 0) {
                        ranLuc = Math.floor(Math.random() * availableLuckyNum.length);
                        output.innerHTML = generateNumWLuckyNum(generatedNum, availableLuckyNum[ranLuc], dontWantNum);
                    } else {
                        output.innerHTML = "Cannot generate phone number";
                    }
                    break;
                case "Merchandising":
                    availableLuckyNum = remNumfromArray(MerchandisingNum, dontWantNum);
                    if (availableLuckyNum.length > 0) {
                        ranLuc = Math.floor(Math.random() * availableLuckyNum.length);
                        output.innerHTML = generateNumWLuckyNum(generatedNum, availableLuckyNum[ranLuc], dontWantNum);
                    } else {
                        output.innerHTML = "Cannot generate phone number";
                    }
                    break;
                case "Technology":
                    availableLuckyNum = remNumfromArray(TechnologyNum, dontWantNum);
                    if (availableLuckyNum.length > 0) {
                        ranLuc = Math.floor(Math.random() * availableLuckyNum.length);
                        output.innerHTML = generateNumWLuckyNum(generatedNum, availableLuckyNum[ranLuc], dontWantNum);
                    } else {
                        output.innerHTML = "Cannot generate phone number";
                    }
                    break;
                case "Education/Wiseness":
                    availableLuckyNum = remNumfromArray(EducationNum, dontWantNum);
                    if (availableLuckyNum.length > 0) {
                        ranLuc = Math.floor(Math.random() * availableLuckyNum.length);
                        output.innerHTML = generateNumWLuckyNum(generatedNum, availableLuckyNum[ranLuc], dontWantNum);
                    } else {
                        output.innerHTML = "Cannot generate phone number";
                    }
                    break;
            }
            //check if there is some error that can't generate phone number
            if (output.innerHTML == "Cannot generate phone number") {
                //show description and put class error-txt to output and description text.
                description.innerHTML = "Please uncheck some exclude number(s) and try again!";
                output.className = "error-txt";
                description.className = "error-txt";
            } else {
                //else if there is no error so tell the user of lucky number and category in that phone number.
                //we use .join("") to show array in term of string without comma like [1,2,3] => 123
                description.innerHTML = "This phone number contains " + availableLuckyNum[ranLuc].join("") + " which is the number in category of " + category;
            }
            if(output.className != "error-txt") {
                //if there is no error in calculating phone number with lucky number that not include dont want num
                //initialize count to zero and final_num
                var count = 0;
                var final_num;
                do {
                    //use function adaptNum to manipulate number to have sum equal to lucky number and save in final_num
                    final_num = adaptNum(generatedNum, availableLuckyNum[ranLuc].join(""), dontWantNum);
                    console.log("final num returned "+final_num);
                    //count increased
                    count++;
                //looping if final_num return null or undefined so that means there's some error to can't calculate that number
                //but looping just 10 round...
                }while(final_num == undefined && count < 10);
                //if final_num is not undefined so this is means there are some answer
                if(final_num != false && final_num != undefined && final_num.length == 10) {
                        //just display and calculate sum of it
                        console.log("FINAL NUM "+final_num);
                        output.innerHTML = final_num.join("");
                        sumoutput.innerHTML = calculateSum(final_num);
                        return;
                    } else {
                        //else if beyond 10 round but still can't find number
                        //just show an error
                        output.innerHTML = "Cannot generate phone number";
                        output.className = "error-txt";
                        sumoutput.innerHTML = "0";
                        description.innerHTML = "System can't generate the phone with sum of "+availableLuckyNum[ranLuc].join("")+", please try again!";
                        description.className = "error-txt";
                    }
            }
        }

        //exclude lucky number that contains some part of excluding number.
        function remNumfromArray(array, dontwant) {
            //declare result array
            var result = Array();
            //loop each member in lucky number array
            for (var i = 0; i < array.length; i++) {
                //if that lucky number not contains any part of excluding number to push it to result array
                //use .filter to filter array that contain excluding number
                //filter by get only intersection of these 2 array
                //check intersection by get each value in array and find the index of that value in dontwant array if there is some index (index != -1) so its intersec!
                //if array that filtered have 0 length so that means there is no excluding number in it so we push that lucky number ro result array
                if (array[i].filter(value => -1 !== dontwant.indexOf(value)).length == 0) {
                    result.push(array[i]);
                }
            }
            return result;
        }

        //generate 1 random number without excluding number
        function genExcludeNum(excludeArray) {
            var num;
            do {
                //random number 0-9
                num = Math.floor(Math.random() * 10);
                //if the random number is in excludeArray so re-generate it.
            } while (excludeArray.includes(num.toString()));
            return num;
        }

        //generate 8 digits with luckynumber and exclude don't want number
        function generateNumWLuckyNum(array, Luckyarray, dontwantArray) {
            //random index to put lucky number in 0-6
            var index = Math.floor(Math.random() * 7);
            //loop 8 digits
            for (var i = 0; i < 7; i++) {
                //if that digits is equal index that we want to put lucky number
                if (i == index) {
                    //so we push luckynumber into array
                    array.push(Luckyarray[0]);
                    array.push(Luckyarray[1]);
                } else {
                    //else call genExcludeNum that will generate number without including don't want number and push it to array.
                    array.push(genExcludeNum(dontwantArray));
                }
            }
            //finally we get 8 digits in terms of [1,2,3,4,5,6,7,8] and we use .join("") to convert it to String and remove commas => 12345678
            return array.join("");
        }

        //access every members in array and calculate sum of that array
        function calculateSum(array) {
            var sum = 0;
            for (var i = 0; i < array.length; i++) {
                sum += parseInt(array[i]);
            }
            return sum;
        }

        //check if all members of array is equal like (1,1,1,1) (5,5,5)
        const allEqual = arr => arr.every(v => v === arr[0])

        //manipulate phone number to have sum equal to lucky number
        function adaptNum(array, luckynumber, dontwantNum) {
            console.log(array);
            //declare phoneSum to keep current total sum of phonenumber
            var phoneSum = calculateSum(array);
            //print different between current sum with lucky number
            console.log(phoneSum + "vs" + luckynumber);
            //available num is array that contains of number that we can use (number that not in dontwantnum array)
            //filter this array by looking for index of each number in dontwantnum array
            //if index is -1 so that's mean that number isn't in dontwantnum and we can use that number
            var availableNum = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9].filter(value => -1 == dontwantNum.indexOf(value));
            //declare canEditNum that is the array of last 8 digits
            var canEditNum = array.slice(2, 10);
            //find luckynumber index and keep in luckyIndex
            var luckyIndex = findLuckyIndex(array, luckynumber)
                //console.log(canEditNum);
                //console.log("LuckyIndex (" + luckynumber[0] + ") is " + luckyIndex);
                //console.log("can edit num is " + canEditNum);
            //update canEditNum to remove lucky number from array so that we will get array of 6 number that we can change it anyway
            //without effecting starting number and lucky number
            canEditNum = canEditNum.slice(0, (luckyIndex)).concat(canEditNum.slice((luckyIndex + 2), (canEditNum.length)));
            console.log("can edit num is " + canEditNum);
            console.log("available num is " + availableNum);
            //check if current phone number sum is greater than lucky number > so we must minus some digits to reduce the sum
            if (phoneSum > luckynumber) {
                //find difference between current sum and lucky number
                var diff = Math.abs(luckynumber - phoneSum);
                //find available slot that we can manipulate our number to reach lucky number
                var availableSlot = calculateSum(canEditNum);
                console.log(diff + "/" + availableSlot);
                //if available slot is less than diff so that is mean we can't find the way to reach lucky number
                if(availableSlot < diff) {
                    console.log("not enough available slot re-gen pls");
                    //calculate();
                    //just return null to make it recalculate all the number again.
                    return;
                } else {
                    //else if available slot is less than difference so it's some way to reach lucky number!
                    //initialize count and error set to 0
                    var count=0;
                    var error=0;
                    //start the loop for manipulate some digits.
                    do {
                        //total remainder that we want to minus is diff
                        console.log("Minus by "+diff);
                        //find maximum number in canEditNum
                        var maxIndex = canEditNum.indexOf(Math.max.apply(null, canEditNum));
                        console.log("Max is [" + maxIndex + "] = " + canEditNum[maxIndex]);
                        //initialize minus to keep number that we must minus digit with this number
                        var minus = 0;
                        //if difference is more than 9
                        if(diff > 9) {
                            //minus by itself to make it become 0 Ex.9-9 = 0
                            minus = canEditNum[maxIndex];
                            console.log("minus @ ["+maxIndex+"] with "+minus);
                        } else {
                            //else if diff is less than 9
                            //check if we minus maximum number with diff is less than 0 or not if yes
                            if((canEditNum[maxIndex] - diff) < 0) {
                                //we set minus number to itself
                                minus = canEditNum[maxIndex];
                            } else {
                                //if not so we can minus that digit with difference without let them being negative number
                                minus = diff;
                            }
                            console.log("minus @ ["+maxIndex+"] with "+minus);
                        }
                        //minus that digit with minus
                        canEditNum[maxIndex] -= minus;
                        //decrease difference
                        diff = diff - minus;
                        //increase count
                        count++;
                        console.log(canEditNum);
                        //if we do until all array is same number (like 080-000-0000) but it's still some difference so we cannot make this happen anymore
                        if (allEqual(canEditNum)) {
                            //just put error=1 and break loop
                            console.log("Can't do this regen pls");
                            error = 1;
                            break;
                        }
                    //looping until diff 0 or count morethan 50
                    }while(diff > 0 && count < 50);
                    //if error = 1 so we return null to find all new phone number
                    if(error == 1) {
                        //calculate();
                        return;
                    }
                }
                //console.log("Minus by " + diff);
                /*
                DO MINUS OPERATION HERE
                */
            //same logic as above but instead of minus we add it instead
            //check if current phone sum is less than lucky number (so we must add it)
            } else if (phoneSum < luckynumber) {
                var diff = Math.abs(luckynumber - phoneSum);
                var availableSlot = findAvailableSlot(canEditNum);
                console.log(diff + "/" + availableSlot);
                if (availableSlot < diff) {
                    console.log("not enough available slot re-gen pls");
                    //calculate();
                    return;
                } else {
                    var count = 0;
                    var error = 0;
                    do {
                        console.log("Total add by " + diff);
                        //instead of finding maximum number to minus > we find minimum number to add.
                        var minIndex = canEditNum.indexOf(Math.min.apply(null, canEditNum));
                        console.log("Min is [" + minIndex + "] = " + canEditNum[minIndex]);
                        var add = 0;
                        if (diff > 9) {
                            //add with maximum number that make it become 9
                            add = 9 - canEditNum[minIndex];
                            console.log("Added with " + add);
                        } else {
                            if ((canEditNum[minIndex] + diff) > 9) {
                                add = 9 - canEditNum[minIndex];
                            } else {
                                add = diff;
                            }
                            console.log("Added with " + add);
                        }
                        canEditNum[minIndex] += parseInt(add);
                        diff = diff - add;
                        count++;
                        console.log(canEditNum);
                        if (allEqual(canEditNum)) {
                            console.log("Can't do this regen pls");
                            error = 1;
                            break;
                        }
                    } while (diff > 0 && count < 50);
                    if (error == 1) {
                        //calculate();
                        return;
                    }
                }
            }

            //after get total sum next find exclude number and removed by calling remExcludeFromAdaptedNum
            canEditNum = remExcludeFromAdaptedNum(canEditNum, dontwantNum);
            //if called and return null so we return null too for finding all new phone number
            if(canEditNum == undefined) {
                return;
            }

            //if not null so that's the way! we just put them together again (at first we sliced it to last 8 digits and removed lucky number)
            var adaptedNum = Array();
            //push first 2 starting number
            adaptedNum.push(array[0]);
            adaptedNum.push(array[1]);
            var j = 0;
            //looping 8 digits and put number back
            for (var i = 0; i < 7; i++) {
                //if reach lucky number index just put lucky number to it.
                if (i == luckyIndex) {
                    adaptedNum.push(parseInt(luckynumber[0]));
                    adaptedNum.push(parseInt(luckynumber[1]));
                } else {
                    //else just push number from canEditNum that we manipulate sum of it already
                    adaptedNum.push(canEditNum[j]);
                    j++;
                }
            }
            //yay! we've got final result so return it!
            console.log("Final result " + adaptedNum);
            return adaptedNum;
            /* change location of function called just put canEditNum into this function and dontwantNum and manipulate with them */
        }

        //find all available slot by access all member of array and minus 9 with all members to find all available slot to manipulate.
        function findAvailableSlot(array) {
            var slot = 0;
            for (var i = 0; i < array.length; i++) {
                //console.log("digit " + i + " is " + array[i]);
                slot += (9 - array[i]);
            }
            return slot;
        }
        
        //remove exclude number from adapted number (number that got sum = lucky number)
        function remExcludeFromAdaptedNum(array, dontwantnum) {
            console.log(array);
            //initialize remainder to 0
            var remainder = 0;
            //access every member in array
            for (var i = 0; i < array.length; i++) {
                //check that if there are some member that in dontwant number?
                if (dontwantnum.includes(array[i])) {
                    //if yes! just minus it by 1
                    do {
                        //check first if we minus it and it will not become negative!
                        if((array[i]-1) > 0) {
                            //yes minus it!
                            array[i] = array[i] - 1;
                            //also increase remainder because we gonna put these remainder back to phone number somewhere
                            remainder++;
                        } else {
                            //if cannot minus just break out from loop
                            break;
                        }
                    //loop until that number is not in dontwantnum array
                    } while (dontwantnum.includes(array[i]));
                }
            }
            //just show array after reduced some digits
            console.log("reduced dontwantnum = " + array);
            //show remainder
            console.log("remainder " + remainder);
            //if remainder is equal 0 so we don't need to do anything just return that array back!
            if(remainder == 0) {
                console.log("no exclude num found in array, just skipped it!");
                return array;
            } else {
                //else let's do something
                //check available slot first, is that suitable for remainder ?
                if (findAvailableSlot(array) < remainder) {
                    //if not just return null and find all new number
                    console.log("cannot put remainder to array");
                    //calculate();
                    return;
                } else {
                    //if not... there is some way!
                    console.log("there is some way");
                    /* FIND THE WAY TO PUT REMAINDER BACK TO ARRAY WITHOUT BEING EXCLUDE NUMBER */
                    //loop every member
                    for(var i=0;i<array.length;i++){
                        //try to add that number with all remainder if it beyond less than 9?
                        if(array[i]+remainder <= 9) {
                            //if less than 9 so we can add it! next.. check if we added and it equal to dont want number ?
                            if(!dontwantnum.includes(array[i]+remainder)) {
                                //if not.. so we can add it!
                                console.log("We're adding "+remainder+" to "+array[i]);
                                //add it and reset remainder to 0
                                array[i] += remainder;
                                remainder = 0;
                                break;
                            } else {
                                //else if can't added just try with to next member
                                console.log("Added but in exclude!");
                                continue;
                            }
                        }
                    }
                    //if try with all members but still have some remainder... so there is no way... just return nulled and find all new number again.
                    if(remainder != 0) {
                        console.log("Cannot find that way... re-gen pls");
                        //calculate();
                        return;
                    } else {
                        //else remainder == 0 so that's answer! just return that array
                        console.log("Excluded number from array "+array);
                        return array;
                    }
                }
            }
        }

        //find lucky index by accessing all member in arrays and check if that index is equal to first lucky number and also next index.
        function findLuckyIndex(array, luckyNum) {
            var index;
            for (var i = 0; i < array.length; i++) {
                if (array[i] == luckyNum[0] && array[i + 1] == luckyNum[1]) {
                    index = i;
                    break;
                }
            }
            return (index - 2);
        }

        //auto generate number when page is opened by calling calculate function.
        calculate();
    </script>
</body>

</html>